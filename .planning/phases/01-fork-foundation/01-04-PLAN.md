---
phase: 01-fork-foundation
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/opencode/src/index.ts
  - packages/opencode/src/cli/logo.ts
  - packages/opencode/src/cli/cmd/tui/component/logo.tsx
  - packages/opencode/src/cli/cmd/tui/context/theme/codemad.json
  - packages/opencode/src/cli/cmd/serve.ts
  - packages/opencode/src/cli/cmd/run.ts
  - packages/opencode/src/cli/cmd/auth.ts
  - packages/opencode/src/cli/cmd/import.ts
  - packages/opencode/src/cli/cmd/web.ts
  - packages/opencode/src/cli/cmd/tui/component/tips.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "CLI help shows CODEMAD banner, not OPEN CODE"
    - "CLI scriptName is codemad, not opencode"
    - "CLI command descriptions reference codemad, not opencode"
    - "TUI tips reference codemad commands and paths"
    - "codemad.json theme exists with brand colors (#FF3300 primary)"
    - "MAD portion of logo uses primary color (red accent)"
  artifacts:
    - path: "packages/opencode/src/index.ts"
      provides: "CLI entry point"
      contains: '.scriptName("codemad")'
    - path: "packages/opencode/src/cli/logo.ts"
      provides: "ASCII banner"
      contains: "CODEMAD"
    - path: "packages/opencode/src/cli/cmd/tui/component/tips.tsx"
      provides: "TUI tips"
      pattern: "codemad"
  key_links:
    - from: "packages/opencode/src/index.ts"
      to: "packages/opencode/src/cli/logo.ts"
      via: "UI.logo() call"
      pattern: "UI\\.logo\\(\\)"
---

<objective>
Complete the CodeMAD rebrand by updating user-visible CLI strings that were missed in Plan 01.

Purpose: Users currently see "OPEN CODE" banner and "opencode" commands in CLI help, breaking the rebrand identity. This gap closure fixes all remaining user-visible strings.

Output: CLI shows CODEMAD banner, commands reference codemad, tips reference codemad paths.
</objective>

<execution_context>
@/Users/costantinomarcello/.claude/get-shit-done/workflows/execute-plan.md
@/Users/costantinomarcello/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-fork-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 0: Create CodeMAD branded theme</name>
  <files>
    - packages/opencode/src/cli/cmd/tui/context/theme/codemad.json (create)
    - packages/opencode/src/cli/cmd/tui/context/theme/opencode.json (delete)
    - packages/opencode/src/cli/cmd/tui/context/theme.tsx (update imports/defaults)
  </files>
  <action>
1. Create packages/opencode/src/cli/cmd/tui/context/theme/codemad.json:
   - Copy from opencode.json as base
   - Update brand colors to match landing page (EXACT values from index.html):

   **Landing page CSS variables (source of truth):**
   ```css
   :root {
     --color-bg: #050505;
     --color-surface: #111111;
     --color-surface-hover: #1a1a1a;
     --color-accent: #FF3300;  /* MAD Red/Orange - PRIMARY */
     --color-success: #00FF94;
     --color-text: #EAEAEA;
     --color-text-dim: #888888;
   }
   /* Additional: #E3C67B (gold), #FF5500, #FF6633 (red variants) */
   ```

   **Key color changes to apply:**
   ```json
   "defs": {
     "darkStep1": "#050505",     // Background
     "darkStep2": "#111111",     // Surface
     "darkStep3": "#1a1a1a",     // Surface hover
     "darkStep9": "#FF3300",     // MAD Red - PRIMARY brand color
     "darkStep10": "#FF6633",    // Lighter red variant
     "darkStep11": "#888888",    // Text muted
     "darkStep12": "#EAEAEA",    // Primary text
     "darkSecondary": "#FF5500", // Secondary (red family)
     "darkGreen": "#00FF94",     // Success green
     "darkYellow": "#E3C67B",    // Gold/progress
     ...
   }
   ```

   - Remove or update $schema (was "https://opencode.ai/theme.json")
   - Keep all other color properties intact
   - Primary color (#FF3300) will be used for logo MAD portion

2. Delete packages/opencode/src/cli/cmd/tui/context/theme/opencode.json:
   - Remove the old branded theme file

3. Update packages/opencode/src/cli/cmd/tui/context/theme.tsx:
   - Line 27: Change import from `opencode` to `codemad`:
     ```ts
     // Before:
     import opencode from "./theme/opencode.json" with { type: "json" }
     // After:
     import codemad from "./theme/codemad.json" with { type: "json" }
     ```
   - Line 288: Change default theme from "opencode" to "codemad"
   - Line 308: Change fallback from "opencode" to "codemad"
   - Line 331: Change fallback from "opencode" to "codemad"
   - Line 356: Change fallback from `store.themes.opencode` to `store.themes.codemad`
   - Also update the themes object registration (where opencode is registered)
  </action>
  <verify>
    - `ls packages/opencode/src/cli/cmd/tui/context/theme/codemad.json` exists
    - `ls packages/opencode/src/cli/cmd/tui/context/theme/opencode.json` does NOT exist
    - `grep '#FF3300' packages/opencode/src/cli/cmd/tui/context/theme/codemad.json` returns match
    - `grep '#050505' packages/opencode/src/cli/cmd/tui/context/theme/codemad.json` returns match (exact bg)
    - `grep 'codemad' packages/opencode/src/cli/cmd/tui/context/theme.tsx` returns matches
    - `grep 'opencode' packages/opencode/src/cli/cmd/tui/context/theme.tsx` returns NO matches (except external URLs)
  </verify>
  <done>
    CodeMAD branded theme exists with exact landing page colors (#FF3300 primary, #050505 bg)
  </done>
</task>

<task type="auto">
  <name>Task 1: Update CLI scriptName and logo</name>
  <files>
    - packages/opencode/src/index.ts
    - packages/opencode/src/cli/logo.ts
  </files>
  <action>
1. Update packages/opencode/src/index.ts line 44:
   - Change `.scriptName("opencode")` to `.scriptName("codemad")`
   - This is the ONLY change needed in this file

2. Update packages/opencode/src/cli/logo.ts:
   - Replace the ASCII art that spells "OPEN CODE" with "CODE MAD"
   - Current structure has left/right arrays for the banner
   - Create new ASCII art for "CODEMAD" using similar block character style
   - The `marks` export ("_^~") triggers color replacement in TUI - use on MAD portion

   **Brand Colors (from landing page):**
   - MAD Red: #FF3300 (accent on "MAD" portion)
   - Background: #050505 / #111111 (dark mode)
   - Text: #EAEAEA (primary text)
   - Style: Technical, angular, cyberpunk-minimal

   New banner - "CODE" on left (white), "MAD" on right (uses marks for red accent):
   ```ts
   export const logo = {
     left: ["                   ", "█▀▀▀ █▀▀█ █▀▀▄ █▀▀▀", "█    █  █ █  █ █▀▀ ", "▀▀▀▀ ▀▀▀▀ ▀▀▀▀ ▀▀▀▀"],
     right: ["              ", "█▄^▄█ █▀▀█ █▀▀▄", "█_▀_█ █^^█ █__█", "▀~~~▀ ▀~~▀ ▀▀▀▀"],
   }
   ```

   The marks (_^~) on the MAD side will be colored by the TUI renderer.
   Keep the `marks` export unchanged: `export const marks = "_^~"`

3. Update packages/opencode/src/cli/cmd/tui/component/logo.tsx line 79:
   - Change `theme.text` to `theme.primary` for the right side (MAD)
   - This makes "MAD" use the primary accent color (red in most themes)

   ```tsx
   // Before:
   <box flexDirection="row">{renderLine(logo.right[index()], theme.text, true)}</box>

   // After:
   <box flexDirection="row">{renderLine(logo.right[index()], theme.primary, true)}</box>
   ```
  </action>
  <verify>
    - `grep -n 'scriptName' packages/opencode/src/index.ts` shows "codemad"
    - `grep -i 'open' packages/opencode/src/cli/logo.ts` returns nothing
    - `grep 'theme.primary' packages/opencode/src/cli/cmd/tui/component/logo.tsx` shows MAD uses primary color
    - Running `bun dev` shows CODEMAD banner with colored "MAD" portion
  </verify>
  <done>
    CLI scriptName is "codemad", ASCII banner spells CODEMAD, and MAD uses primary accent color
  </done>
</task>

<task type="auto">
  <name>Task 2: Update CLI command descriptions</name>
  <files>
    - packages/opencode/src/cli/cmd/serve.ts
    - packages/opencode/src/cli/cmd/run.ts
    - packages/opencode/src/cli/cmd/auth.ts
    - packages/opencode/src/cli/cmd/import.ts
    - packages/opencode/src/cli/cmd/web.ts
  </files>
  <action>
1. packages/opencode/src/cli/cmd/serve.ts:
   - Line 9: "starts a headless opencode server" -> "starts a headless codemad server"
   - Line 12: "Warning: OPENCODE_SERVER_PASSWORD" -> keep env var name but update message if needed
   - Line 16: "opencode server listening" -> "codemad server listening"

2. packages/opencode/src/cli/cmd/run.ts:
   - Line 30: "run opencode with a message" -> "run codemad with a message"
   - Line 84: "attach to a running opencode server" -> "attach to a running codemad server"
   - Keep internal URLs like "http://opencode.internal" unchanged (internal, not user-visible)

3. packages/opencode/src/cli/cmd/auth.ts:
   - Line 222: "opencode auth provider" -> "codemad auth provider"
   - Line 333: "configure it in opencode.json" -> keep config filename unchanged
   - Line 342: "Configure via opencode.json" -> keep config filename unchanged
   - Line 347-348: Keep opencode.ai URL as external service reference

4. packages/opencode/src/cli/cmd/import.ts:
   - Line 14: Keep "opencode.ai share URL" as external service reference

5. packages/opencode/src/cli/cmd/web.ts:
   - Line 34: "start opencode server" -> "start codemad server"
   - Line 66: "opencode.local" -> "codemad.local"

Note: DO NOT change:
- Environment variable names (OPENCODE_*)
- Config file names (opencode.json)
- External service URLs (opencode.ai)
- Internal URLs (opencode.internal)
  </action>
  <verify>
    - `grep -r 'run opencode' packages/opencode/src/cli/cmd/` returns nothing
    - `grep -r 'headless opencode' packages/opencode/src/cli/cmd/` returns nothing
    - `grep -r 'start opencode' packages/opencode/src/cli/cmd/` returns nothing
  </verify>
  <done>
    All CLI command descriptions reference codemad instead of opencode
  </done>
</task>

<task type="auto">
  <name>Task 3: Update TUI tips</name>
  <files>
    - packages/opencode/src/cli/cmd/tui/component/tips.tsx
  </files>
  <action>
Update the TIPS array to replace opencode references with codemad:

1. Line 57: "Run {highlight}/share{/highlight} to create a public link to your conversation at opencode.ai"
   -> Keep opencode.ai URL (external service)

2. Line 83: "{highlight}opencode.json{/highlight}" -> keep config filename unchanged

3. Line 84: "{highlight}~/.config/opencode/opencode.json{/highlight}" -> keep path unchanged

4. Line 90: "OpenCode auto-handles OAuth" -> "CodeMAD auto-handles OAuth"

5. Line 91: "{highlight}.opencode/command/{/highlight}" -> keep directory unchanged

6. Line 94: "{highlight}.opencode/agent/{/highlight}" -> keep directory unchanged

7. Line 99: "OpenCode auto-formats files" -> "CodeMAD auto-formats files"

8. Line 102: "OpenCode uses LSP servers" -> "CodeMAD uses LSP servers"

9. Line 103: "{highlight}.opencode/tool/{/highlight}" -> keep directory unchanged

10. Line 105: "{highlight}.opencode/plugin/{/highlight}" -> keep directory unchanged

11. Line 107: "prevent OpenCode from reading" -> "prevent CodeMAD from reading"

12. Lines 108-119: CLI commands - change "opencode" to "codemad":
    - "opencode run" -> "codemad run"
    - "opencode --continue" -> "codemad --continue"
    - "opencode run -f" -> "codemad run -f"
    - "opencode serve" -> "codemad serve"
    - "opencode run --attach" -> "codemad run --attach"
    - "opencode upgrade" -> "codemad upgrade"
    - "opencode auth list" -> "codemad auth list"
    - "opencode agent create" -> "codemad agent create"
    - "opencode github install" -> "codemad github install"

13. Line 117: "/opencode in GitHub" -> "/codemad in GitHub"

14. Line 120: "/oc on PR code lines" -> keep /oc (short command, not the product name)

15. Line 122: "{highlight}.opencode/themes/{/highlight}" -> keep directory unchanged

16. Lines 138-145: CLI commands - change "opencode" to "codemad":
    - "opencode debug config" -> "codemad debug config"
    - "docker run...ghcr.io/anomalyco/opencode" -> keep Docker image path unchanged
    - "OpenCode Zen" -> keep as external service name

Note: Keep these UNCHANGED:
- Config directories (.opencode/)
- Config filenames (opencode.json)
- External service names (OpenCode Zen, opencode.ai)
- Docker image paths
- Short commands (/oc)
  </action>
  <verify>
    - `grep -c 'codemad run' packages/opencode/src/cli/cmd/tui/component/tips.tsx` returns > 0
    - `grep -c 'codemad serve' packages/opencode/src/cli/cmd/tui/component/tips.tsx` returns > 0
    - `grep 'CodeMAD auto' packages/opencode/src/cli/cmd/tui/component/tips.tsx` returns matches
  </verify>
  <done>
    TUI tips reference codemad CLI commands and CodeMAD product name
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Type check:
   ```bash
   bun turbo typecheck
   ```
   Must pass without errors

2. CLI banner verification:
   ```bash
   bun dev --help 2>&1 | head -10
   ```
   Should show CODEMAD ASCII banner, not OPEN CODE

3. String verification:
   ```bash
   # Should return nothing (no "run opencode" strings)
   grep -r "run opencode" packages/opencode/src/cli/cmd/

   # Should return codemad references
   grep -r "codemad run" packages/opencode/src/cli/cmd/tui/component/tips.tsx
   ```

4. Preserved references (should still exist):
   ```bash
   # Config paths unchanged
   grep -r "opencode.json" packages/opencode/src/cli/cmd/tui/component/tips.tsx

   # External services unchanged
   grep -r "opencode.ai" packages/opencode/src/cli/cmd/tui/component/tips.tsx
   ```
</verification>

<success_criteria>
1. CLI help shows CODEMAD ASCII banner
2. CLI scriptName is "codemad" (visible in help/error messages)
3. All CLI command descriptions reference "codemad" not "opencode"
4. TUI tips reference "codemad" CLI commands
5. Config file names (.opencode/, opencode.json) remain unchanged
6. External service URLs (opencode.ai) remain unchanged
7. Type check passes
</success_criteria>

<output>
After completion, create `.planning/phases/01-fork-foundation/01-04-SUMMARY.md`
</output>
