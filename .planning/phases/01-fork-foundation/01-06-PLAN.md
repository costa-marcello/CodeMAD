# Plan 01-06: ESLint + Prettier + Strict TypeScript Quality Gate

**Goal:** Add comprehensive code quality infrastructure with all errors fixed upfront.

**Execution Strategy:** 4 waves with parallel agents

---

## Wave 1: Setup (Sequential)

### Task 1: Install Dependencies

**Agent:** Bash
**Command:**

```bash
bun add -D eslint @eslint/js typescript-eslint eslint-plugin-solid eslint-config-prettier lint-staged
```

**Verification:** Packages appear in package.json devDependencies

### Task 2: Create Config Files

**Agent:** general-purpose
**Files to create:**

**2a. `/eslint.config.mjs`**

```javascript
import js from "@eslint/js"
import tseslint from "typescript-eslint"
import solid from "eslint-plugin-solid/configs/typescript"
import prettier from "eslint-config-prettier"

export default tseslint.config(
  {
    ignores: ["**/node_modules/**", "**/dist/**", "**/.turbo/**", "**/sst-env.d.ts", "**/*.gen.ts", "**/generated/**"],
  },
  js.configs.recommended,
  ...tseslint.configs.recommended,
  {
    files: ["**/*.ts", "**/*.tsx"],
    rules: {
      "@typescript-eslint/no-unused-vars": [
        "error",
        {
          argsIgnorePattern: "^_",
          varsIgnorePattern: "^_",
        },
      ],
      "@typescript-eslint/no-explicit-any": "error",
      "@typescript-eslint/no-non-null-assertion": "off",
      "no-console": "off",
    },
  },
  {
    files: [
      "packages/app/**/*.tsx",
      "packages/ui/**/*.tsx",
      "packages/desktop/**/*.tsx",
      "packages/enterprise/**/*.tsx",
    ],
    ...solid,
  },
  prettier,
)
```

**2b. `/tsconfig.base.json`**

```json
{
  "$schema": "https://json.schemastore.org/tsconfig",
  "compilerOptions": {
    "target": "ESNext",
    "module": "ESNext",
    "moduleResolution": "bundler",
    "skipLibCheck": true,
    "allowSyntheticDefaultImports": true,
    "esModuleInterop": true,
    "isolatedModules": true,
    "strict": true,
    "noUncheckedIndexedAccess": true,
    "noImplicitOverride": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "lib": ["ESNext", "DOM", "DOM.Iterable"]
  }
}
```

**2c. Update `/package.json`** - add scripts and lint-staged:

```json
{
  "scripts": {
    "lint": "eslint packages/",
    "lint:fix": "eslint packages/ --fix",
    "format": "prettier --check \"packages/**/*.{ts,tsx,json,md,css}\"",
    "format:fix": "prettier --write \"packages/**/*.{ts,tsx,json,md,css}\"",
    "check": "bun turbo check"
  },
  "lint-staged": {
    "*.{ts,tsx}": ["eslint --fix --max-warnings=0", "prettier --write"],
    "*.{json,md,css}": ["prettier --write"]
  }
}
```

---

## Wave 2: Parallel Setup (Tasks 3, 4, 5 in parallel)

### Task 3: Format Codebase

**Agent:** Bash
**Command:** `bun format:fix`
**Commit:** `chore: format codebase with prettier`

### Task 4: Update Turbo + Husky

**Agent:** general-purpose

**4a. Update `/turbo.json`** - add tasks:

```json
{
  "tasks": {
    "typecheck": {},
    "lint": {},
    "check": {
      "dependsOn": ["typecheck", "lint"]
    }
  }
}
```

**4b. Create `/.husky/pre-commit`**

```bash
#!/bin/sh
bunx lint-staged
```

**4c. Update `/.husky/pre-push`** - replace `bun typecheck` with `bun turbo check`

### Task 5: Update Package tsconfigs

**Agent:** general-purpose
**Scope:** All packages extend `../../tsconfig.base.json`

Packages to update:

- packages/opencode/tsconfig.json
- packages/script/tsconfig.json
- packages/slack/tsconfig.json
- packages/app/tsconfig.json
- packages/ui/tsconfig.json
- packages/desktop/tsconfig.json
- packages/util/tsconfig.json
- packages/plugin/tsconfig.json
- packages/enterprise/tsconfig.json
- packages/function/tsconfig.json
- packages/web/tsconfig.json

Each preserves its specific settings (jsx, jsxImportSource, paths, types) while extending base.

---

## Wave 3: Fix Errors (Tasks 6, 7, 8 in parallel)

### Task 6: Fix opencode Type Errors

**Agent:** general-purpose
**Scope:** `/packages/opencode/src/**/*.ts`

Fix `noUncheckedIndexedAccess` errors:

- Array indexing: `arr[0]` → `arr[0]!` or `arr[0] ?? fallback`
- Object access: `obj[key]` → `obj[key]!` or optional chaining

### Task 7: Fix script/slack/other Type Errors

**Agent:** general-purpose
**Scope:**

- `/packages/script/src/**/*.ts`
- `/packages/slack/src/**/*.ts`
- Other packages with type errors

### Task 8: Fix Lint Errors

**Agent:** general-purpose
**Scope:** All packages

Fix:

- `@typescript-eslint/no-unused-vars` - Remove or prefix with `_`
- `@typescript-eslint/no-explicit-any` - Add proper types
- SolidJS reactive violations

---

## Wave 4: Verify (Sequential)

### Task 9: Final Verification & Commit

**Agent:** Bash

```bash
# Full quality gate
bun turbo check

# Commits (if all pass)
git add eslint.config.mjs tsconfig.base.json
git commit -m "chore: add eslint and typescript base config"

git add turbo.json .husky/
git commit -m "chore: add lint task and pre-commit hook"

git add packages/*/tsconfig.json
git commit -m "chore: update tsconfigs to extend base"

git add packages/
git commit -m "fix: resolve all lint and type errors"
```

---

## Success Criteria

- [ ] `bun turbo check` passes
- [ ] Pre-commit hook runs lint-staged
- [ ] Pre-push hook runs full check
- [ ] Zero lint errors
- [ ] Zero type errors
